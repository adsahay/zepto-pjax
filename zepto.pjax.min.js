(function(b){function o(a,c,d){d=p(c,d);c=a.currentTarget;if(!(1<a.which||a.metaKey)&&!(location.protocol!==c.protocol||location.host!==c.host)&&!(c.hash&&c.href.replace(c.hash,"")===location.href.replace(location.hash,"")))return c={url:c.href,container:b(c).attr("data-pjax"),clickedElement:b(c),fragment:null},b.pjax(b.extend({},c,d)),a.preventDefault(),!1}function m(a){return a.replace(/\?_pjax=true&?/,"?").replace(/_pjax=true&?/,"").replace(/\?$/,"")}function u(a){var c=document.createElement("a");
c.href=a;return c}function p(a,c){a&&c?c.container=a:c=b.isPlainObject(a)?a:{container:a};c.container&&(c.container=q(c.container));return c}function q(a){a=b(a);if(a.length){if(""!==a.selector&&a.context===document)return a;if(a.attr("id"))return b("#"+a.attr("id"));throw"cant get selector for pjax container!";}throw"no pjax container for "+a.selector;}b.noop=function(){};b.isPlainObject=function(a){return"object"===typeof a&&a.constructor===Object};b.inArray=function(a,c,b){var f;if(c){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(c,
a,b);f=c.length;for(b=b?0>b?Math.max(0,f+b):b:0;b<f;b++)if(b in c&&c[b]===a)return b}return-1};b.fn.pjax=function(a,b){b=p(a,b);return this.live("click",function(a){return o(a,b)})};var h=b.pjax=function(a){a=b.extend({},b.ajaxSettings,h.defaults,a);b.isFunction(a.url)&&(a.url=a.url());var c=a.url,d=u(c).hash,f=a.beforeSend,r=a.complete,s=a.success,k=a.error;a.context=q(a.container);var n;a.beforeSend=function(g,l){var d=this;c=m(l.url);0<l.timeout&&(n=setTimeout(function(){var c=b.Event("pjax:timeout");
d.trigger(c,[g,a]);!1!==c.result&&g.abort("timeout")},l.timeout),l.timeout=0);g.setRequestHeader("X-PJAX","true");var e;if(f&&(e=f.apply(this,arguments),!1===e))return!1;e=b.Event("pjax:beforeSend");this.trigger(e,[g,l]);e=e.result;if(!1===e)return!1;this.trigger("pjax:start",[g,a]);this.trigger("start.pjax",[g,a])};a.complete=function(b,c){n&&clearTimeout(n);r&&r.apply(this,arguments);this.trigger("pjax:complete",[b,c,a]);this.trigger("pjax:end",[b,a]);this.trigger("end.pjax",[b,a])};a.error=function(g,
d,f){var e=g.getResponseHeader("X-PJAX-URL");e&&(c=m(e));k&&k.apply(this,arguments);e=b.Event("pjax:error");this.trigger(e,[g,d,f,a]);"abort"!==d&&!1!==e.result&&(window.location=c)};a.success=function(g,f,k){var e=k.getResponseHeader("X-PJAX-URL");e&&(c=m(e));var i,e=document.title;if(a.fragment){i=b("<html>").html(g);var j=i.find(a.fragment);if(j.length)this.html(j.contents()),i=i.find("title").text()||j.attr("title")||j.data("title");else return window.location=c}else{if(!g.trim()||/<html/i.test(g))return window.location=
c;this.html(g);i=this.find("title").remove().text()}i&&(document.title=i.trim());i={url:c,pjax:this.selector,fragment:a.fragment,timeout:a.timeout};a.replace?(h.active=!0,window.history.replaceState(i,document.title,c)):a.push&&(h.active||(window.history.replaceState(b.extend({},i,{url:null}),e),h.active=!0),window.history.pushState(i,document.title,c));(a.replace||a.push)&&window._gaq&&_gaq.push(["_trackPageview"]);""!==d&&(window.location.href=d);s&&s.apply(this,arguments);this.trigger("pjax:success",
[g,f,k,a])};var j=h.xhr;j&&4>j.readyState&&(j.onreadystatechange=b.noop,j.abort());h.options=a;h.xhr=b.ajax(a);b(document).trigger("pjax",[h.xhr,a]);return h.xhr};h.defaults={timeout:650,push:!0,replace:!1,data:{_pjax:!0},type:"GET",dataType:"html"};h.click=o;var t="state"in window.history,v=location.href;b(window).bind("popstate",function(a){var c=!t&&location.href==v;t=!0;if(!c&&(a=a.state)&&a.pjax)c=a.pjax,b(c+"").length?b.pjax({url:a.url||location.href,fragment:a.fragment,container:c,push:!1,
timeout:a.timeout}):window.location=location.href});b.support={};b.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/);b.support.pjax||(b.pjax=function(a){var c=b.isFunction(a.url)?a.url():a.url,d=a.type?a.type.toUpperCase():"GET",f=b("<form>",{method:"GET"===d?"GET":"POST",action:c,style:"display:none"});"GET"!==d&&"POST"!==d&&f.append(b("<input>",{type:"hidden",name:"_method",value:d.toLowerCase()}));
a=a.data;if("string"===typeof a)b.each(a.split("&"),function(a,c){var d=c.split("=");f.append(b("<input>",{type:"hidden",name:d[0],value:d[1]}))});else if("object"===typeof a)for(key in a)f.append(b("<input>",{type:"hidden",name:key,value:a[key]}));b(document.body).append(f);f.submit()},b.pjax.click=b.noop,b.fn.pjax=function(){return this})})(Zepto||jQuery);